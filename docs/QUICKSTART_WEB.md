# LookingGlass Web å¿«é€Ÿå¯åŠ¨æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©ä½ å¿«é€Ÿå¯åŠ¨ LookingGlass ç³»ç»Ÿå¹¶ä½¿ç”¨ Web ç•Œé¢ã€‚

## å‰ææ¡ä»¶

- å·²æˆåŠŸæ„å»ºé¡¹ç›®ï¼ˆè¿è¡Œ `make build`ï¼‰
- å·²é…ç½® `master/config.yaml` å’Œ `agent/config.yaml`

## å¿«é€Ÿå¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨ Master æœåŠ¡å™¨

```bash
./bin/master -config master/config.yaml
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
[INFO] Starting LookingGlass Master grpc_port=50051 ws_port=8080
[INFO] Starting gRPC server port=50051
[INFO] Starting HTTP/WebSocket server port=8080 static_dir=web/
```

### 2. å¯åŠ¨è‡³å°‘ä¸€ä¸ª Agent

åœ¨æ–°çš„ç»ˆç«¯çª—å£ä¸­ï¼š

```bash
./bin/agent -config agent/config.yaml
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¾“å‡ºï¼š
```
[INFO] Starting LookingGlass Agent id=local-agent name=Local Test Agent
[INFO] Registered executor: ping
[INFO] Registered executor: mtr
[INFO] Registered executor: nexttrace
[INFO] Starting gRPC server port=50052
[INFO] Agent registered successfully
```

### 3. æ‰“å¼€ Web ç•Œé¢

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://localhost:8080
```

## Web ç•Œé¢ä½¿ç”¨è¯´æ˜

### ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ” LookingGlass        [â— Connected]      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ Agents   â”‚  â”‚ Command Panel            â”‚â”‚
â”‚ â”‚          â”‚  â”‚ Agent:  [Select...]      â”‚â”‚
â”‚ â”‚ â€¢ local  â”‚  â”‚ Tool:   [Select...]      â”‚â”‚
â”‚ â”‚   online â”‚  â”‚ Target: [______]         â”‚â”‚
â”‚ â”‚          â”‚  â”‚ [Execute]                â”‚â”‚
â”‚ â”‚          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚          â”‚  â”‚ Output                   â”‚â”‚
â”‚ â”‚          â”‚  â”‚ $ ping 8.8.8.8           â”‚â”‚
â”‚ â”‚          â”‚  â”‚ PING 8.8.8.8...          â”‚â”‚
â”‚ â”‚          â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”‚
â”‚ â”‚          â”‚  â”‚ â–¶ History                â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½¿ç”¨æ­¥éª¤

1. **ç­‰å¾…è¿æ¥**
   - é¡µé¢åŠ è½½åä¼šè‡ªåŠ¨è¿æ¥åˆ° Master
   - å³ä¸Šè§’æ˜¾ç¤º "â— Connected" (ç»¿è‰²)è¡¨ç¤ºå·²è¿æ¥

2. **é€‰æ‹© Agent**
   - å·¦ä¾§é¢æ¿æ˜¾ç¤ºæ‰€æœ‰åœ¨çº¿çš„ Agent
   - ç‚¹å‡»ä¸€ä¸ª Agent æˆ–ä½¿ç”¨ä¸‹æ‹‰èœå•é€‰æ‹©

3. **é€‰æ‹©ä»»åŠ¡**
   - æ ¹æ® Agent æ”¯æŒçš„ä»»åŠ¡è‡ªåŠ¨å¡«å……
   - å¯é€‰ï¼šPingã€MTRã€NextTrace ç­‰

4. **è¾“å…¥ç›®æ ‡**
   - è¾“å…¥ IP åœ°å€æˆ–åŸŸå
   - ä¾‹å¦‚ï¼š`8.8.8.8` æˆ– `google.com`

5. **æ‰§è¡Œå‘½ä»¤**
   - ç‚¹å‡» "Execute" æŒ‰é’®
   - å®æ—¶è¾“å‡ºä¼šæ˜¾ç¤ºåœ¨ç»ˆç«¯åŒºåŸŸ
   - å¯ä»¥ç‚¹å‡» "Cancel" å–æ¶ˆæ‰§è¡Œ

6. **æŸ¥çœ‹å†å²**
   - ç‚¹å‡» "â–¶ History" å±•å¼€å†å²è®°å½•
   - ç‚¹å‡»å†å²é¡¹å¯å¿«é€Ÿé‡æ–°æ‰§è¡Œ

## æµ‹è¯•ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šPing Google DNS

1. é€‰æ‹©ä»»æ„åœ¨çº¿ Agent
2. å·¥å…·é€‰æ‹© "Ping"
3. ç›®æ ‡è¾“å…¥ `8.8.8.8`
4. ç‚¹å‡» Execute

é¢„æœŸè¾“å‡ºï¼š
```
$ ping 8.8.8.8
PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
64 bytes from 8.8.8.8: icmp_seq=1 ttl=118 time=13.2 ms
64 bytes from 8.8.8.8: icmp_seq=2 ttl=118 time=12.9 ms
64 bytes from 8.8.8.8: icmp_seq=3 ttl=118 time=13.1 ms
64 bytes from 8.8.8.8: icmp_seq=4 ttl=118 time=13.0 ms
```

### ç¤ºä¾‹ 2ï¼šMTR è·¯ç”±è¿½è¸ª

1. é€‰æ‹©ä»»æ„åœ¨çº¿ Agent
2. å·¥å…·é€‰æ‹© "MTR"
3. ç›®æ ‡è¾“å…¥ `google.com`
4. ç‚¹å‡» Execute

é¢„æœŸè¾“å‡ºï¼šMTR è·¯ç”±è¡¨

### ç¤ºä¾‹ 3ï¼šNextTrace è·¯ç”±åˆ†æ

1. é€‰æ‹©ä»»æ„åœ¨çº¿ Agent
2. å·¥å…·é€‰æ‹© "NextTrace"
3. ç›®æ ‡è¾“å…¥ `1.1.1.1`
4. ç‚¹å‡» Execute

é¢„æœŸè¾“å‡ºï¼šå¢å¼ºå‹è·¯ç”±è¿½è¸ªä¿¡æ¯

## å¸¸è§é—®é¢˜

### 1. æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨

**é—®é¢˜**: å³ä¸Šè§’æ˜¾ç¤º "â— Disconnected" (çº¢è‰²)

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤ Master æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰çš„é”™è¯¯ä¿¡æ¯
- ç¡®è®¤é˜²ç«å¢™æœªé˜»æ­¢ 8080 ç«¯å£
- å¦‚æœ Master åœ¨è¿œç¨‹æœåŠ¡å™¨ï¼Œä¿®æ”¹ `web/js/app.js` ä¸­çš„ WebSocket URL

### 2. Agent åˆ—è¡¨ä¸ºç©º

**é—®é¢˜**: å·¦ä¾§ Agent é¢æ¿æ˜¾ç¤º "No agents available"

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤è‡³å°‘æœ‰ä¸€ä¸ª Agent æ­£åœ¨è¿è¡Œ
- æ£€æŸ¥ Agent æ—¥å¿—ï¼Œç¡®è®¤æ³¨å†ŒæˆåŠŸ
- æ£€æŸ¥ Master æ—¥å¿—ï¼ŒæŸ¥çœ‹ Agent è¿æ¥çŠ¶æ€
- ä½¿ç”¨ CLI æµ‹è¯•ï¼š`./bin/lookingglass-cli ping --agent=local-agent --target=8.8.8.8`

### 3. ä»»åŠ¡é€‰é¡¹ä¸ºç©º

**é—®é¢˜**: Task ä¸‹æ‹‰èœå•æ²¡æœ‰é€‰é¡¹

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿å·²é€‰æ‹©ä¸€ä¸ª Agent
- æ£€æŸ¥ Agent é…ç½®ä¸­çš„ `executor.tasks` éƒ¨åˆ†ï¼Œç¡®ä¿ä»»åŠ¡å·²å¯ç”¨
- ç¡®è®¤ Agent æˆåŠŸæ³¨å†Œäº†ä»»åŠ¡ï¼ˆæŸ¥çœ‹ Agent å¯åŠ¨æ—¥å¿—ä¸­çš„ task_namesï¼‰

### 4. å‘½ä»¤æ‰§è¡Œå¤±è´¥

**é—®é¢˜**: ç‚¹å‡» Execute åæ˜¾ç¤ºé”™è¯¯

**å¯èƒ½åŸå› **:
1. ç›®æ ‡åœ°å€æ ¼å¼é”™è¯¯
   - è§£å†³ï¼šä½¿ç”¨æœ‰æ•ˆçš„ IP æˆ–åŸŸå
2. Agent ä¸æ”¯æŒè¯¥ä»»åŠ¡
   - è§£å†³ï¼šæ£€æŸ¥ Agent çš„ `executor.tasks` é…ç½®ï¼Œç¡®ä¿ä»»åŠ¡å·²å¯ç”¨
3. å‘½ä»¤æ‰§è¡Œæƒé™é—®é¢˜
   - è§£å†³ï¼šç¡®ä¿ Agent æœ‰æƒé™æ‰§è¡Œç½‘ç»œè¯Šæ–­å‘½ä»¤
4. ä»»åŠ¡å¹¶å‘è¾¾åˆ°é™åˆ¶
   - è§£å†³ï¼šæ£€æŸ¥ `global_concurrency` å’Œä»»åŠ¡çš„ `concurrency.max` é…ç½®
5. ç›®æ ‡ä¸å¯è¾¾
   - è§£å†³ï¼šæ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

## é…ç½®è¯´æ˜

### Master é…ç½® (master/config.yaml)

å…³é”®é…ç½®é¡¹ï¼š

```yaml
server:
  ws_port: 8080              # Web ç•Œé¢ç«¯å£ï¼ˆHTTP + WebSocketï¼‰
  grpc_port: 50051           # Agent è¿æ¥ç«¯å£

task:
  default_ping_count: 4      # å‰ç«¯ä½¿ç”¨çš„é»˜è®¤ Ping æ¬¡æ•°
  default_mtr_count: 4       # å‰ç«¯ä½¿ç”¨çš„é»˜è®¤ MTR æ¬¡æ•°
```

### Agent é…ç½® (agent/config.yaml)

å…³é”®é…ç½®é¡¹ï¼š

```yaml
executor:
  global_concurrency: 10     # å…¨å±€å¹¶å‘é™åˆ¶

  tasks:                     # ä»»åŠ¡é…ç½®åˆ—è¡¨
    ping:
      enabled: true          # æ˜¯å¦å¯ç”¨
      display_name: "Ping"
      requires_target: true
      concurrency:
        max: 3

    mtr:
      enabled: true
      display_name: "MTR"
      requires_target: true

# è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚é˜…: docs/TASK_CONFIG.md
```

## è¿›é˜¶ä½¿ç”¨

### ä¿®æ”¹ WebSocket åœ°å€

å¦‚æœ Master è¿è¡Œåœ¨è¿œç¨‹æœåŠ¡å™¨ï¼ˆå¦‚ `192.168.1.100`ï¼‰ï¼Œéœ€è¦ä¿®æ”¹å‰ç«¯ä»£ç ï¼š

ç¼–è¾‘ `web/js/app.js`ï¼Œæ‰¾åˆ° `connect()` æ–¹æ³•ï¼š

```javascript
async connect() {
    // ä¿®æ”¹è¿™é‡Œ
    const host = '192.168.1.100';  // æ”¹ä¸º Master çš„ IP
    const port = 8080;
    const wsUrl = `ws://${host}:${port}/ws`;
    // ...
}
```

### ä½¿ç”¨ HTTPS/WSS

å¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ HTTPSï¼š

1. ä½¿ç”¨ Nginx åå‘ä»£ç†ï¼š
```nginx
server {
    listen 443 ssl;
    server_name lookingglass.example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://localhost:8080;
    }

    location /ws {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

2. ä¿®æ”¹å‰ç«¯ WebSocket URL ä½¿ç”¨ `wss://`

## ä¸‹ä¸€æ­¥

- ğŸ“š æŸ¥çœ‹ [web/README.md](web/README.md) äº†è§£å‰ç«¯è¯¦ç»†æ–‡æ¡£
- ğŸ”§ æŸ¥çœ‹ [CLAUDE.md](CLAUDE.md) äº†è§£ç³»ç»Ÿæ¶æ„
- ğŸš€ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒï¼ˆé…ç½® HTTPSã€è®¤è¯ç­‰ï¼‰
- ğŸ¨ è‡ªå®šä¹‰ç•Œé¢æ ·å¼ï¼ˆç¼–è¾‘ `web/css/style.css`ï¼‰

## è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰çš„é”™è¯¯ä¿¡æ¯
2. æŸ¥çœ‹ Master å’Œ Agent çš„æ—¥å¿—æ–‡ä»¶
3. å‚è€ƒ [web/README.md](web/README.md) ä¸­çš„æ•…éšœæ’æŸ¥éƒ¨åˆ†
